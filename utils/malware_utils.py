import os
import csv

# Directory where malware scripts are stored
SCRIPTS_DIR = "scripts/"
LOGS_FILE = "outputs/malware_logs.csv"

# Ensure the logs directory exists
os.makedirs(os.path.dirname(LOGS_FILE), exist_ok=True)

def list_available_scripts():
    """List all available malware scripts in the scripts directory."""
    scripts = [f for f in os.listdir(SCRIPTS_DIR) if os.path.isfile(os.path.join(SCRIPTS_DIR, f))]
    if not scripts:
        print("No scripts found in the 'scripts/' directory.")
    return scripts

def select_malware_script():
    """Display a menu to select a malware script."""
    scripts = list_available_scripts()
    if not scripts:
        return None

    print("\n=== Available Malware Scripts ===")
    for idx, script in enumerate(scripts, start=1):
        print(f"{idx}. {script}")

    try:
        choice = int(input("Select a script by number: ")) - 1
        if 0 <= choice < len(scripts):
            selected_script = os.path.join(SCRIPTS_DIR, scripts[choice])
            print(f"Selected script: {scripts[choice]}")
            log_malware_selection(scripts[choice])
            return selected_script
        else:
            print("Invalid selection.")
            return None
    except ValueError:
        print("Invalid input. Please enter a number.")
        return None

def log_malware_selection(script_name):
    """Log details of the selected malware script."""
    with open(LOGS_FILE, 'a', newline='') as f:
        writer = csv.writer(f)
        writer.writerow([script_name])
    print(f"Malware selection logged: {script_name}")

def attach_malware():
    """Allow the user to select and attach a malware script."""
    selected_script = select_malware_script()
    if selected_script:
        print(f"The malware script '{selected_script}' is ready for attachment.")
        return selected_script
    else:
        print("No malware script was selected.")
        return None
